#user  nobody;
worker_processes  1;
#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       6060;
        server_name  localhost;

        # ─── Main app (index.html lives here) ───────────────────
        location / {
            root   html;
            index  index.html index.htm;
        }

        # ─── TallyApp v2 image directory browser ────────────────
        # Serves:  D:\software\nginx-1.28.2\html\tallyapp\v2\
        # Access:  http://localhost:6060/tallyapp/v2/
        #
        # KEY FIX: using a regex location (~*) so ALL subdirectory
        # requests under /tallyapp/v2/ are caught and served correctly.
        # The alias path uses $1 to append whatever comes after the prefix.

        location ~* ^/tallyapp/v2(/.*)?$ {
            alias  D:/software/nginx-1.28.2/html/tallyapp/v2$1;

            # Enable recursive directory listing
            autoindex             on;
            autoindex_format      json;   # JSON — required by index.html
            autoindex_exact_size  on;     # exact byte sizes
            autoindex_localtime   on;     # file modification times

            # ── CORS so index.html can fetch the listing ─────────
            add_header  Access-Control-Allow-Origin   "*"           always;
            add_header  Access-Control-Allow-Methods  "GET, OPTIONS" always;
            add_header  Access-Control-Allow-Headers  "Accept"       always;

            # Preflight OPTIONS
            if ($request_method = OPTIONS) {
                add_header  Access-Control-Allow-Origin  "*";
                add_header  Access-Control-Allow-Methods "GET, OPTIONS";
                add_header  Access-Control-Max-Age       1728000;
                add_header  Content-Length               0;
                add_header  Content-Type                 "text/plain";
                return 204;
            }
        }

        # ─── Error pages ────────────────────────────────────────
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}