<div class="flex min-w-full flex-col rounded-xl bg-background p-2">
    <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="flex justify-between gap-4">
            <div class="w-4/12">
                <label class="text-sm text-muted-foreground">Employee Name</label>
                <select formControlName="employeeId" (change)="onEmployeeSelect($event)"
                    class="block py-2 text-sm text-gray-500 bg-transparent border-1 border-b-2 border-gray-200 appearance-none dark:text-gray-400 dark:border-gray-700 focus:outline-none focus:ring-0 focus:border-gray-200 peer">
                    <option value="" selected>Select Employee</option>
                    <ng-container *ngFor="let emp of allEmployees; let i = index;">
                        <option [value]="emp.id">{{emp.fullName}} - [{{emp.employeeType}}] - [{{emp.employeeBillingType}}]</option>
                    </ng-container>
                </select>
                <div class="is__invalid-error" *ngIf="isFieldInvalid(form, 'employeeId')">
                    {{ getErrorMessage(form, 'employeeId') }}
                </div>
            </div>
            <div class="w-2/12">
                <label class="text-sm text-muted-foreground">Year</label>
                <input type="number" min="2020" max="2030" formControlName="year"
                    class="w-full rounded border border-border bg-background px-3 py-2 text-sm text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary" />
                <div class="is__invalid-error" *ngIf="isFieldInvalid(form, 'year')">
                    {{ getErrorMessage(form, 'year') }}
                </div>
            </div>
            <div class="w-2/12">
                <label class="text-sm text-muted-foreground">Month</label>
                <select formControlName="month"
                    class="w-full rounded border border-border bg-background px-3 py-2 text-sm text-muted-foreground focus:border-primary focus:ring-1 focus:ring-primary">
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
                <div class="is__invalid-error" *ngIf="isFieldInvalid(form, 'month')">
                    {{ getErrorMessage(form, 'month') }}
                </div>
            </div>
            <div class="w-4/12">
                <div class="flex flex-row gap-2">
                    <div class="w-full">
                        <label class="text-sm text-muted-foreground">Actions</label>
                        <div class="flex flex-row gap-2">
                            <button type="submit" class="flex flex-row px-4 py-2 rounded-md"
                                [disabled]="form.invalid || loading" [ngClass]="{
                                    'bg-primary text-white': !form.invalid && !loading,
                                    'bg-gray-400 text-gray-200 cursor-not-allowed': form.invalid || loading
                                }">
                                <svg-icon *ngIf="!loading" src="./assets/icons/heroicons/outline/search.svg"
                                    [svgClass]="'h-5 w-5'"></svg-icon>
                                <div *ngIf="loading"
                                    class="h-5 w-5 border-2 border-white border-t-transparent rounded-full animate-spin">
                                </div>
                                <span class="ml-2">{{ loading ? 'Loading...' : 'Search' }}</span>
                            </button>
                            <button type="button" (click)="exportToCSV()" *ngIf="monthlyIncomeData"
                                class="flex flex-row px-4 py-2 rounded-md bg-green-500 text-white hover:bg-green-600">
                                <svg-icon src="./assets/icons/heroicons/outline/plus-v2.svg"
                                    [svgClass]="'h-5 w-5'"></svg-icon>
                                <span class="ml-2">Report</span>
                            </button>
                            <button type="button" (click)="generateReport()"
                                *ngIf="selectedEmployee && selectedEmployee.employeeBillingType!=='MONTHLY' && selectedEmployee.employeeBillingType!=='NOT_APPLICABLE'"
                                class="flex flex-row px-4 py-2 rounded-md bg-green-500 text-white hover:bg-green-600">
                                <svg-icon src="./assets/icons/heroicons/outline/download.svg"
                                    [svgClass]="'h-5 w-5'"></svg-icon>
                                <span class="ml-2">Download Report</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- Monthly Income Data Display -->
    <div class="mt-4 flex min-w-full flex-col rounded-xl bg-background" *ngIf="monthlyIncomeData">

        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 mt-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div
                        class="bg-gradient-to-r from-blue-500 to-purple-600 text-white w-20 h-20 rounded-full flex items-center justify-center text-2xl font-bold">
                        <!-- {{ monthlyIncomeData.employeeName.split(' ').map(n => n[0]).join('').substring(0, 2) }} -->
                    </div>
                    <div class="flex flex-col gap-1">
                        <h1 class="text-3xl font-bold text-gray-800">{{ monthlyIncomeData.employeeName }}</h1>
                        <p class="text-gray-600">Joining Date: {{ formatDate(monthlyIncomeData.joiningDate) }}
                        </p>
                        <p class="text-gray-600">
                            Billing Type:
                            <span class="px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                MONTHLY
                            </span>
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="font-medium">
                        {{ monthlyIncomeData.monthName }} {{ monthlyIncomeData.year }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Net Income -->
            <app-card-stats statSubtitle="Net Income" [statTitle]="monthlyIncomeData.netIncome"
                [statPercentColor]="monthlyIncomeData.netIncome >= 0 ? 'text-green-500' : 'text-red-500'"
                statIconName="fas fa-wallet"
                [borderColor]="monthlyIncomeData.netIncome >= 0 ? 'border-green-500' : 'border-red-500'"
                [statIconColor]="monthlyIncomeData.netIncome >= 0 ? 'bg-gradient-to-r from-green-200 to-green-400' : 'bg-gradient-to-r from-red-200 to-red-400'">
            </app-card-stats>

            <!-- Base Salary -->
            <app-card-stats statSubtitle="Base Salary" [statTitle]="monthlyIncomeData.baseSalary"
                statPercentColor="text-blue-500" statIconName="fas fa-dollar-sign" borderColor="border-blue-500"
                statIconColor="bg-gradient-to-r from-blue-200 to-blue-400">
            </app-card-stats>

            <!-- Attendance Rate -->
            <div
                class="border-green-500 relative flex flex-col min-w-0 break-words rounded-lg bg-background p-4 xl:mb-0 shadow-lg border-l-4">
                <div class="flex-auto p-4">
                    <div class="flex flex-wrap">
                        <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                            <span class="font-semibold text-lg text-blueGray-700">
                                {{ monthlyIncomeData.attendanceMetrics.attendancePercentage.toFixed(1) }}%

                                <span class="ml-1 text-sm text-gray-500">({{ monthlyIncomeData.attendanceMetrics.daysPresent }}/{{
                                    monthlyIncomeData.attendanceMetrics.totalWorkingDays }} days)</span>
                            </span>
                            <h5 class="text-blueGray-400 uppercase font-bold text-xs mt-2">
                                Attendance Rate
                            </h5>
                        </div>
                        <div class="relative w-auto pl-4 flex-initial">
                            <div
                                class="bg-gradient-to-r from-green-200 to-green-400 text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Total Expenses -->
            <app-card-stats statSubtitle="Total Expenses" [statTitle]="monthlyIncomeData.totalExpenses"
                statPercentColor="text-red-500" statIconName="fas fa-credit-card" borderColor="border-red-500"
                statIconColor="bg-gradient-to-r from-red-200 to-red-400">
            </app-card-stats>
        </div>

        <!-- Additional Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Work Units -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Work Units</h3>
                        <p class="text-3xl font-bold text-blue-600">{{
                            monthlyIncomeData.attendanceMetrics.totalWorkUnits }}</p>
                        <p class="text-sm text-gray-500">Avg: {{
                            monthlyIncomeData.attendanceMetrics.averageWorkUnitsPerDay.toFixed(1) }}/day</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-tasks text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Expense Count -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Expenses</h3>
                        <p class="text-3xl font-bold text-orange-600">{{ monthlyIncomeData.expenseCount }}</p>
                        <p class="text-sm text-gray-500">transactions</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-receipt text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Working Days</h3>
                        <p class="text-3xl font-bold text-green-600">{{ monthlyIncomeData.attendanceMetrics.totalWorkingDays }}</p>
                        <p class="text-sm text-gray-500">days</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-calendar-day text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Calendar -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-blue-100 p-2 rounded-lg">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-800">Attendance Calendar</h2>
                <div class="ml-auto flex gap-4 text-sm">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-green-500 rounded"></div>
                        <span class="text-gray-600">Present</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-red-500 rounded"></div>
                        <span class="text-gray-600">Absent</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-gray-400 rounded"></div>
                        <span class="text-gray-600">Weekend</span>
                    </div>
                </div>
            </div>

            <!-- Calendar Grid -->
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Sun</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Mon</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Tue</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Wed</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Thu</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Fri</th>
                            <th class="border border-gray-200 p-2 text-center font-medium text-gray-700">Sat</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let week of calendarWeeks">
                            <td *ngFor="let day of week" class="border border-gray-200 h-16 p-1 align-top" [ngClass]="{
            'bg-green-100 border-l-4 border-green-500': day?.attendance?.isPresent,
            'bg-red-100 border-l-4 border-red-500': day?.attendance && !day?.attendance?.isPresent && !day?.attendance?.isWeekend,
            'bg-gray-100': day?.attendance?.isWeekend && !day?.attendance?.isPresent,
            'hover:bg-gray-50': day && !day?.attendance
        }">
                                <div *ngIf="day" class="h-full flex flex-col">
                                    <div class="font-semibold text-sm text-gray-800 mb-1">{{ day.day }}</div>
                                    <div *ngIf="day.attendance" class="text-xs text-gray-600 flex-1">
                                        <!-- Show attendance info if present (even on weekends) -->
                                        <div *ngIf="day.attendance.isPresent">
                                            <div class="flex items-center gap-1 mb-1">
                                                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                                                <span class="text-xs">P</span>
                                                <span *ngIf="day.attendance.isWeekend"
                                                    class="text-xs text-gray-500">(Weekend)</span>
                                            </div>
                                            <div *ngIf="day.attendance.workUnits > 0" class="text-xs">
                                                {{ day.attendance.workUnits }} units
                                            </div>
                                            <div *ngIf="day.attendance.dailyIncome > 0" class="text-xs text-green-600">
                                                {{ formatCurrency(day.attendance.dailyIncome) }}
                                            </div>
                                        </div>

                                        <!-- Show absent info for regular days -->
                                        <div *ngIf="!day.attendance.isPresent && !day.attendance.isWeekend">
                                            <div class="flex items-center gap-1 mb-1">
                                                <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                                <span class="text-xs">A</span>
                                            </div>
                                        </div>

                                        <!-- Show weekend info only when not present -->
                                        <div *ngIf="day.attendance.isWeekend && !day.attendance.isPresent"
                                            class="text-xs text-gray-500 text-center">
                                            Weekend
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Summary Cards Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Financial Breakdown -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-green-100 p-2 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800">Financial Summary</h2>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-money-bill-wave text-blue-500"></i>
                            <span class="text-gray-600">Monthly Salary</span>
                        </div>
                        <span class="font-semibold text-blue-600 text-lg">
                            {{ formatCurrency(monthlyIncomeData.monthlySalary) }}
                        </span>
                    </div>

                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-calculator text-green-500"></i>
                            <span class="text-gray-600">Base Salary (Pro-rated)</span>
                        </div>
                        <span class="font-semibold text-green-600 text-lg">
                            {{ formatCurrency(monthlyIncomeData.baseSalary) }}
                        </span>
                    </div>
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-calculator text-green-500"></i>
                            <span class="text-gray-600">Total Income</span>
                        </div>
                        <span class="font-semibold text-green-600 text-lg">
                            {{ formatCurrency(monthlyIncomeData.totalIncome) }}
                        </span>
                    </div>

                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-credit-card text-red-500"></i>
                            <span class="text-gray-600">Total Expenses</span>
                        </div>
                        <span class="font-semibold text-red-600 text-lg">
                            -{{ formatCurrency(monthlyIncomeData.totalExpenses) }}
                        </span>
                    </div>

                    <div class="border-t pt-4">
                        <div
                            class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-wallet text-purple-600"></i>
                                <span class="text-gray-800 font-medium">Net Income</span>
                            </div>
                            <span class="font-bold text-2xl" [ngClass]="{
                                      'text-green-600': monthlyIncomeData.netIncome >= 0,
                                      'text-red-600': monthlyIncomeData.netIncome < 0
                                  }">
                                {{ formatCurrency(monthlyIncomeData.netIncome) }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Attendance Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-blue-100 p-2 rounded-lg">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800">Attendance Analysis</h2>
                </div>

                <div class="space-y-6">
                    <!-- Attendance Statistics -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">{{
                                monthlyIncomeData.attendanceMetrics.daysPresent }}</div>
                            <div class="text-sm text-gray-600">Days Present</div>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="text-2xl font-bold text-red-600">{{
                                monthlyIncomeData.attendanceMetrics.daysAbsent }}</div>
                            <div class="text-sm text-gray-600">Days Absent</div>
                        </div>
                    </div>

                    <!-- Attendance Progress Bar -->
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Attendance Rate</span>
                            <span class="text-sm text-gray-600">{{
                                monthlyIncomeData.attendanceMetrics.attendancePercentage.toFixed(1) }}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 rounded-full transition-all duration-500"
                                [style.width.%]="monthlyIncomeData.attendanceMetrics.attendancePercentage"></div>
                        </div>
                    </div>

                    <!-- Work Units Analysis -->
                    <div class="border-t pt-4">
                        <h4 class="font-medium text-gray-800 mb-3">Work Performance</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Work Units</span>
                                <span class="font-semibold">{{ monthlyIncomeData.attendanceMetrics.totalWorkUnits
                                    }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Average per Day</span>
                                <span class="font-semibold">{{
                                    monthlyIncomeData.attendanceMetrics.averageWorkUnitsPerDay.toFixed(2) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Working Days</span>
                                <span class="font-semibold">{{ monthlyIncomeData.attendanceMetrics.totalWorkingDays
                                    }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Indicator -->
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-chart-line text-blue-600"></i>
                            <span class="font-medium text-blue-800">Performance Indicator</span>
                        </div>
                        <div class="text-sm text-blue-700">
                            <ng-container *ngIf="monthlyIncomeData.attendanceMetrics.attendancePercentage >= 90">
                                Excellent attendance! Keep up the great work.
                            </ng-container>
                            <ng-container
                                *ngIf="monthlyIncomeData.attendanceMetrics.attendancePercentage >= 75 && monthlyIncomeData.attendanceMetrics.attendancePercentage < 90">
                                Good attendance. Consider improving consistency.
                            </ng-container>
                            <ng-container
                                *ngIf="monthlyIncomeData.attendanceMetrics.attendancePercentage >= 50 && monthlyIncomeData.attendanceMetrics.attendancePercentage < 75">
                                Average attendance. Significant improvement needed.
                            </ng-container>
                            <ng-container *ngIf="monthlyIncomeData.attendanceMetrics.attendancePercentage < 50">
                                Poor attendance. Immediate attention required.
                            </ng-container>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 flex min-w-full flex-col rounded-xl  bg-background" *ngIf="employeeData">

        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 mt-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-100  rounded-full">
                        <img *ngIf="employeeData.employeeProfileImage" [src]="employeeData.employeeProfileImage.url"
                            alt="Employee Profile Image" class="w-20 h-20 rounded-full object-cover">
                    </div>
                    <div class="flex flex-col gap-1">
                        <h1 class="text-3xl font-bold text-gray-800">{{ employeeData.employeeName }}</h1>
                        <p class="text-gray-600">Joining Date: {{ formatDate(employeeData.joiningDate) }}</p>
                        <p class="text-gray-600">
                            Employee Billing Type:
                            <span class="px-2 py-1 rounded text-xs font-medium bg-green-100">
                                {{ employeeData.employeeBillingType | word}}
                            </span>
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="font-medium" *ngIf="!employeeData.lifeTimeEarnings">
                        {{ formatDate(employeeData.fromDate) }} - {{ formatDate(employeeData.toDate) }}
                    </span>
                    <span class="font-medium" *ngIf="employeeData.lifeTimeEarnings">
                        Life Time Summary
                    </span>
                </div>

            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Net Earnings - Green theme -->
            <app-card-stats statSubtitle="Net Earnings" [statTitle]="employeeData.netEarnings"
                statPercentColor="text-green-500" statIconName="fas fa-chart-line" borderColor="border-green-500"
                statIconColor="bg-gradient-to-r from-green-200 to-green-400">
            </app-card-stats>

            <!-- Total Earnings - Emerald theme -->
            <app-card-stats statSubtitle="Total Earnings" [statTitle]="employeeData.totalUnitEarnings"
                statPercentColor="text-emerald-500" statIconName="fas fa-dollar-sign" borderColor="border-emerald-500"
                statIconColor="bg-gradient-to-r from-emerald-200 to-emerald-400">
            </app-card-stats>

            <!-- Total Expenses - Red theme -->
            <app-card-stats statSubtitle="Total Expenses" [statTitle]="employeeData.totalExpenses"
                borderColor="border-red-500" statPercentColor="text-red-500" statIconName="fas fa-credit-card"
                statIconColor="bg-gradient-to-r from-red-200 to-red-400">
            </app-card-stats>

            <!-- Products Produced - Blue theme -->
            <div
                class="border-blue-500 relative flex flex-col min-w-0 break-words rounded-lg bg-background p-4 xl:mb-0 shadow-lg border-l-4">
                <div class="flex-auto">
                    <div class="flex flex-wrap">
                        <div class="relative w-full pr-4 max-w-full flex-grow flex-1">
                            <span class="font-semibold text-lg text-blueGray-700">
                                {{ employeeData.totalUnits }}
                            </span>
                            <h5 class="text-blueGray-400 uppercase font-bold text-xs mt-2">
                                Total Units
                            </h5>
                        </div>
                        <div class="relative w-auto pl-4 flex-initial">
                            <div
                                class="bg-gradient-to-r from-blue-200 to-blue-400 text-white p-3 text-center inline-flex items-center justify-center w-12 h-12 shadow-lg rounded-full">
                                <i class="fas fa-boxes"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Expense Breakdown -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-purple-100 p-2 rounded-lg">
                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800">Expense Breakdown</h2>
                </div>

                <div class="space-y-4">
                    <div *ngFor="let expense of employeeData.expenseTypeSummaries; let i = index" class="relative">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-3">
                                <div class="text-gray-600">
                                    <ng-container [ngSwitch]="expense.expenseType">
                                        <svg *ngSwitchCase="'SALARY'" class="w-5 h-5" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                        <svg *ngSwitchCase="'FOOD_ALLOWANCE'" class="w-5 h-5" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z" />
                                        </svg>
                                        <svg *ngSwitchCase="'TRANSPORT'" class="w-5 h-5" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                        </svg>
                                        <svg *ngSwitchDefault class="w-5 h-5" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z" />
                                        </svg>
                                    </ng-container>
                                </div>
                                <span class="font-medium text-gray-700">
                                    {{ formatExpenseType(expense.expenseType) }}
                                </span>
                            </div>
                            <div class="text-right">
                                <span class="font-semibold text-gray-800">
                                    {{ formatCurrency(expense.totalAmount) }}
                                </span>
                                <span class="text-sm text-gray-500 ml-2">
                                    ({{ getExpensePercentage(expense.totalAmount) }}%)
                                </span>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-500"
                                [style.width.%]="getExpensePercentage(expense.totalAmount)"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Summary -->
            <div class="bg-white rounded-lg shadow-lg p-6 ">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-green-100 p-2 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800">Financial Summary</h2>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <span class="text-gray-600">Total Earnings</span>
                        <span class="font-semibold text-green-600 text-lg">
                            {{ formatCurrency(employeeData.totalUnitEarnings) }}
                        </span>
                    </div>

                    <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                        <span class="text-gray-600">Total Expenses</span>
                        <span class="font-semibold text-red-600 text-lg">
                            -{{ formatCurrency(employeeData.totalExpenses) }}
                        </span>
                    </div>

                    <div class="border-t pt-4">
                        <div
                            class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg">
                            <span class="text-gray-800 font-medium">Net Earnings</span>
                            <span class="font-bold text-green-600 text-2xl">
                                {{ formatCurrency(employeeData.netEarnings) }}
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- No Data State -->
    <div *ngIf="(!monthlyIncomeData && !employeeData) && !loading" class="text-center py-12">
        <i class="fas fa-search text-gray-400 text-6xl mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">No Data Found</h3>
        <p class="text-gray-500">Select an employee, year, and month to view income data.</p>
    </div>
</div>