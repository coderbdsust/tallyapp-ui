<!-- src/app/features/invoice-standalone/invoice-standalone-add/invoice-standalone-add.component.html -->

<div class="flex min-w-full flex-col rounded-xl border border-muted/20 bg-background p-2">
  <form [formGroup]="invForm" (ngSubmit)="submitInvoice()">
    <div class="flex flex-col m-6 gap-6 divide-y-2 divide-dashed divide-gray-200">
      
      <!-- Invoice Header Section -->
      <div class="flex flex-row justify-between">
        <div class="w-2/6 pr-2">
          <img [src]="invoice?.organization?.logoB64 || 'https://placehold.co/400'" 
               alt="Organization Logo"
               class="w-auto h-20 border border-dashed border-border shadow-md mb-4">

          <div class="flex flex-col">
            <input type="hidden" formControlName="id" />

            <!-- Invoice Type Badge -->
            <div class="mb-2">
              <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                    [ngClass]="{
                      'bg-purple-100 text-purple-800': invoice?.invoiceType === InvoiceType.QUOTATION,
                      'bg-blue-100 text-blue-800': invoice?.invoiceType === InvoiceType.BILL
                    }">
                {{ invoice?.invoiceType }}
              </span>
            </div>

            <label class="text-sm text-muted-foreground">Invoice No</label>
            <input type="text" 
                   [value]="invoice?.invoiceNumber" 
                   readonly
                   class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

            <label class="text-sm text-muted-foreground">Invoice Date</label>
            <input type="date" 
                   formControlName="invoiceDate"
                   class="mb-2 w-full border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary" />

            <label class="text-sm text-muted-foreground">Status</label>
            <select formControlName="invoiceStatus"
                    class="mb-2 w-full border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary">
              <option *ngFor="let status of getFilteredInvoiceStatuses()" [value]="status">
                {{ status | word }}
              </option>
            </select>

            <label class="text-sm text-muted-foreground">Delivery Date</label>
            <input type="date" 
                   formControlName="deliveryDate"
                   class="mb-2 w-full border border-border bg-background px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary" />
          </div>
        </div>

        <!-- Organization Info -->
        <div class="w-2/6 pl-2">
          <img [src]="invoice?.barcode || './assets/img/barcode-v2.png'" 
               alt="Barcode"
               class="w-full h-12 bg-gray-100 mb-2">

          <label class="text-sm text-muted-foreground">Organization Name</label>
          <input type="text" readonly [value]="invoice?.organization?.orgName"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

          <label class="text-sm text-muted-foreground">Address</label>
          <textarea readonly [value]="invoice?.organization?.orgAddressLine"
                    class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground"></textarea>

          <label class="text-sm text-muted-foreground">Postcode</label>
          <input type="text" readonly [value]="invoice?.organization?.orgAddressPostcode"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

          <label class="text-sm text-muted-foreground">TIN No</label>
          <input type="text" readonly [value]="invoice?.organization?.orgTinNumber"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

          <label class="text-sm text-muted-foreground">VAT Registration No</label>
          <input type="text" readonly [value]="invoice?.organization?.orgVatNumber"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

          <label class="text-sm text-muted-foreground">Email</label>
          <input type="text" readonly [value]="invoice?.organization?.orgEmail"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />

          <label class="text-sm text-muted-foreground">Contact No</label>
          <input type="text" readonly [value]="invoice?.organization?.orgMobileNo"
                 class="bg-gray-100 mb-2 w-full border border-muted/20 px-3 py-2 text-sm text-muted-foreground" />
        </div>
      </div>

      <!-- Customer Section -->
      <div class="flex flex-row pt-6">
        <div class="w-5/12 pr-4">
          <div class="bg-white border-gray-200 p-4">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold text-gray-800">Billing Address</h2>
            </div>

            <!-- Customer Search -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Search Customer</label>
              <ng-select [items]="allCustomers" 
                        bindValue="id" 
                        bindLabel="label" 
                        formControlName="customerId"
                        placeholder="Search by name, mobile, or email" 
                        (change)="onSelectCustomer($event)"
                        (keydown.enter)="onCustomerSearchKeyType($event)"
                        class="min-h-[38px]">
              </ng-select>
            </div>

            <!-- Customer Details -->
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Customer Name *</label>
                <input type="text" 
                       placeholder="Enter customer name" 
                       formControlName="customerName"
                       class="w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(invForm, 'customerName')">
                  {{ getErrorMessage(invForm, 'customerName') }}
                </div>
              </div>

              <div class="flex flex-row gap-3">
                <div class="w-5/12">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
                  <input type="text" 
                         placeholder="Phone number" 
                         formControlName="customerMobile"
                         class="w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                  <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(invForm, 'customerMobile')">
                    {{ getErrorMessage(invForm, 'customerMobile') }}
                  </div>
                </div>
                <div class="w-7/12">
                  <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input type="email" 
                         placeholder="Email address" 
                         formControlName="customerEmail"
                         class="w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Address *</label>
                <textarea placeholder="Enter full address" 
                          formControlName="customerAddressLine"
                          rows="3"
                          class="w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm resize-none"></textarea>
                <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(invForm, 'customerAddressLine')">
                  {{ getErrorMessage(invForm, 'customerAddressLine') }}
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Postcode</label>
                <input type="text" 
                       placeholder="Postal code" 
                       formControlName="customerPostcode"
                       class="w-full px-3 py-2 border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
              </div>

              <div class="flex items-center justify-end gap-1">
                <button type="submit"
                        class="inline-flex items-center px-3 py-1.5 text-xs rounded-lg font-medium text-green-600 bg-green-50 border border-green-200 transition-colors"
                        [disabled]="invForm.invalid" 
                        [ngClass]="{
                          'hover:bg-green-200': !invForm.invalid,
                          'hover:bg-red-200 cursor-not-allowed': invForm.invalid
                        }">
                  <svg-icon src="./assets/icons/heroicons/outline/folder.svg" [svgClass]="'h-3 w-3 mr-1'"></svg-icon>
                  Save Customer
                </button>

                <button type="button" 
                        (click)="createNewCustomer()"
                        class="inline-flex items-center px-3 py-1.5 text-xs rounded-lg font-medium text-red-600 bg-red-50 border border-red-200 hover:bg-red-100 transition-colors">
                  <svg-icon src="./assets/icons/heroicons/outline/minus.svg" [svgClass]="'h-3 w-3 mr-1'"></svg-icon>
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Continue from Part 1 -->

      <!-- Products Section -->
      <div class="flex flex-col pt-6">
        <div class="w-full bg-white border-gray-200 p-4">
          <h2 class="text-lg font-semibold text-gray-800 mb-4">Products/Services</h2>
          
          <form [formGroup]="productForm">
            <div class="overflow-x-auto border-gray-200">
              <table class="w-full table-auto border-collapse text-left text-sm">
                <thead class="bg-gray-50 border-b border-gray-200">
                  <tr>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-12">SL</th>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Product Details</th>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-32 text-right">Unit Rate</th>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-24 text-center">Qty</th>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-32 text-right">Amount</th>
                    <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-16 text-center">Action</th>
                  </tr>
                </thead>
                
                <tbody class="divide-y divide-gray-200">
                  <!-- Existing Products -->
                  <tr *ngFor="let product of invoice?.products?.items; let i = index" 
                      class="hover:bg-gray-50 transition-colors">
                    <td class="px-3 py-4 text-gray-700 font-medium">{{i+1}}</td>
                    <td class="px-3 py-4">
                      <div class="space-y-1">
                        <div class="font-semibold text-gray-900 text-sm">{{product.name}}</div>
                        <div class="text-xs text-gray-500 font-mono">{{product.code || 'N/A'}}</div>
                        <div class="text-xs text-gray-600 leading-relaxed">{{product.description}}</div>
                      </div>
                    </td>
                    <td class="px-3 py-4 text-right text-gray-700 font-medium">
                      <span class="text-sm">{{product.pricePerUnit | number:'1.2-2'}}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                      <span class="inline-flex items-center px-3 py-2 rounded-lg bg-gray-50 text-gray-800 text-sm font-medium">
                        <span class="font-bold">{{ product.quantity }}</span>
                        <span class="ml-1 text-gray-600">{{ product.unitType }}</span>
                      </span>
                    </td>
                    <td class="px-3 py-4 text-right text-gray-900 font-semibold">
                      <span class="text-sm">{{getTotalProductAmount(product) | number:'1.2-2'}}</span>
                    </td>
                    <td class="px-3 py-4 text-center">
                      <button type="button" 
                              (click)="deleteProduct(product)"
                              class="inline-flex items-center justify-center w-8 h-8 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors"
                              title="Remove product">
                        <svg-icon src="./assets/icons/heroicons/outline/trash.svg" [svgClass]="'h-4 w-4'"></svg-icon>
                      </button>
                    </td>
                  </tr>
                  
                  <!-- Add New Product Row -->
                  <tr class="bg-gray-50 border-t-2 border-gray-300">
                    <td class="px-3 py-4 text-gray-700 font-medium align-top"></td>
                    <td class="px-3 py-4">
                      <div class="space-y-2">
                        <!-- Product Selection from Catalog -->
                        <ng-select [items]="allProducts" 
                                  bindValue="id" 
                                  bindLabel="label"
                                  formControlName="productId" 
                                  placeholder="Search product by name or code"
                                  (change)="onSelectProduct($event)"
                                  (keydown.enter)="onSearchKeyType($event)"
                                  class="text-sm">
                        </ng-select>

                        <!-- Manual Product Entry -->
                        <input type="text" 
                               placeholder="Product Name *"
                               formControlName="productName"
                               class="w-full px-2 py-1 border border-gray-300 text-sm">
                        
                        <input type="text" 
                               placeholder="Product Code (optional)"
                               formControlName="productCode"
                               class="w-full px-2 py-1 border border-gray-300 text-sm">
                        
                        <textarea formControlName="productDescription" 
                                 placeholder="Product description (optional)..."
                                 rows="2"
                                 class="w-full px-2 py-1 border border-gray-200 text-xs resize-none"></textarea>

                        <select formControlName="productUnitType"
                                class="w-full px-2 py-1 border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                          <option value="" disabled>Select Unit Type</option>
                          <option *ngFor="let unit of allUnitTypes" [value]="unit.value">
                            {{ unit.displayName ? unit.value + ' (' + unit.symbol + ')' : unit.symbol }}
                          </option>
                        </select>
                      </div>
                    </td>
                    <td class="px-3 py-4 align-top">
                      <div class="w-32">
                        <input type="number" 
                               step="1"
                               placeholder="0.00"
                               formControlName="productUnitRate"
                               class="w-full px-3 py-2 border border-gray-300 text-sm text-right focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                    </td>
                    <td class="px-3 py-4 align-top">
                      <div class="w-32">
                        <input type="number" 
                               min="1"
                               step="1"
                               placeholder="0"
                               formControlName="productQuantity"
                               class="w-full px-3 py-2 border border-gray-300 text-sm text-center focus:outline-none focus:ring-2 focus:ring-blue-500">
                      </div>
                    </td>
                    <td class="px-3 py-4 align-top">
                      <div class="w-32">
                        <input type="text" 
                               readonly 
                               formControlName="productAmount"
                               placeholder="0.00"
                               class="w-full px-3 py-2 bg-gray-50 border border-gray-200 text-sm text-right text-gray-600">
                      </div>
                    </td>
                    <td class="px-3 py-4 text-center align-top">
                      <button type="button"
                              [disabled]="!productForm.valid"
                              [ngClass]="{
                                'text-green-600 hover:text-green-700 hover:bg-green-50 cursor-pointer': productForm.valid,
                                'text-gray-400 cursor-not-allowed': !productForm.valid
                              }"
                              (click)="productForm.valid && submitProduct()"
                              class="inline-flex items-center justify-center w-8 h-8 rounded-full transition-colors"
                              title="Add product">
                        <svg-icon src="./assets/icons/heroicons/outline/check-circle.svg" [svgClass]="'h-5 w-5'"></svg-icon>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </form>
        </div>
      </div>

      <!-- Payment History and Summary Section -->
      <div class="flex flex-row justify-between gap-6 pt-6">
        <!-- Payment History Table (Only for Bills) -->
        <div class="w-4/6" *ngIf="canAddPayments()">
          <div class="bg-white border-gray-200 p-4">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Customer Payment History</h2>
            
            <form [formGroup]="paymentForm">
              <div class="overflow-x-auto border-gray-200">
                <table class="w-full table-auto border-collapse text-left text-sm">
                  <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                      <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                      <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Method</th>
                      <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider">Reference</th>
                      <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider text-right">Amount</th>
                      <th class="px-3 py-3 text-xs font-semibold text-gray-600 uppercase tracking-wider w-16 text-center">Action</th>
                    </tr>
                  </thead>
                  
                  <tbody class="divide-y divide-gray-200">
                    <!-- Existing Payments -->
                    <tr *ngFor="let payment of invoice?.payments?.payments; let i = index" 
                        class="hover:bg-gray-50 transition-colors">
                      <td class="px-3 py-3 text-gray-700">
                        <span class="text-sm">{{payment.paymentDate | date:'MMM dd, yyyy'}}</span>
                      </td>
                      <td class="px-3 py-3">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                          {{payment.paymentMethod}}
                        </span>
                      </td>
                      <td class="px-3 py-3 text-gray-600 text-sm font-mono">{{payment.reference || '-'}}</td>
                      <td class="px-3 py-3 text-right text-gray-900 font-semibold">
                        <span class="text-sm">{{payment.amount | number:'1.2-2'}}</span>
                      </td>
                      <td class="px-3 py-3 text-center">
                        <button type="button"
                                (click)="deletePayment(payment)"
                                class="inline-flex items-center justify-center w-8 h-8 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-full transition-colors"
                                title="Remove payment">
                          <svg-icon src="./assets/icons/heroicons/outline/trash.svg" [svgClass]="'h-4 w-4'"></svg-icon>
                        </button>
                      </td>
                    </tr>
                    
                    <!-- Add New Payment Row -->
                    <tr class="bg-gray-50 border-t-2">
                      <td class="px-3 py-4">
                        <input type="date" 
                               formControlName="paymentDate"
                               class="w-full px-2 py-2 border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-green-500">
                        <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(paymentForm, 'paymentDate')">
                          {{ getErrorMessage(paymentForm, 'paymentDate') }}
                        </div>
                      </td>
                      <td class="px-3 py-4">
                        <select formControlName="paymentMethod"
                                class="w-full px-2 py-2 border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-green-500">
                          <option value="" disabled>Select Method</option>
                          <option *ngFor="let method of allPaymentMethods" [value]="method">{{method}}</option>
                        </select>
                        <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(paymentForm, 'paymentMethod')">
                          {{ getErrorMessage(paymentForm, 'paymentMethod') }}
                        </div>
                      </td>
                      <td class="px-3 py-4">
                        <input type="text" 
                               placeholder="Transaction ID/Reference"
                               formControlName="paymentRef"
                               class="w-full px-2 py-2 border border-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-green-500">
                      </td>
                      <td class="px-3 py-4">
                        <input type="number" 
                               step="0.01"
                               placeholder="0.00"
                               formControlName="paymentAmount"
                               class="w-full px-2 py-2 border border-gray-300 text-sm text-right focus:outline-none focus:ring-2 focus:ring-green-500">
                        <div class="text-red-500 text-xs mt-1" *ngIf="isFieldInvalid(paymentForm, 'paymentAmount')">
                          {{ getErrorMessage(paymentForm, 'paymentAmount') }}
                        </div>
                      </td>
                      <td class="px-3 py-4 text-center">
                        <button type="button"
                                [disabled]="!paymentForm.valid"
                                [ngClass]="{
                                  'text-green-600 hover:text-green-700 hover:bg-green-100 cursor-pointer': paymentForm.valid,
                                  'text-gray-400 cursor-not-allowed': !paymentForm.valid
                                }"
                                (click)="paymentForm.valid && submitPayment()"
                                class="inline-flex items-center justify-center w-8 h-8 rounded-full transition-colors"
                                title="Add payment">
                          <svg-icon src="./assets/icons/heroicons/outline/check-circle.svg" [svgClass]="'h-5 w-5'"></svg-icon>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </form>
          </div>
        </div>

        <!-- Quotation Note (Only for Quotations) -->
        <div class="w-4/6" *ngIf="!canAddPayments()">
          <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
            <div class="flex items-start gap-3">
              <svg-icon src="./assets/icons/heroicons/outline/information-circle.svg" [svgClass]="'h-6 w-6 text-purple-600'"></svg-icon>
              <div>
                <h3 class="text-sm font-semibold text-purple-900 mb-1">Quotation Mode</h3>
                <p class="text-xs text-purple-700">
                  This is a quotation. Payments cannot be added to quotations. 
                  Convert this quotation to a bill to enable payment tracking.
                </p>
                <button type="button"
                        (click)="convertToBill()"
                        class="mt-3 inline-flex items-center px-3 py-1.5 text-xs font-medium text-purple-700 bg-white border border-purple-300 rounded-md hover:bg-purple-100 transition-colors">
                  <svg-icon src="./assets/icons/heroicons/outline/arrow-path.svg" [svgClass]="'h-4 w-4 mr-1'"></svg-icon>
                  Convert to Bill
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Invoice Summary -->
        <div [ngClass]="canAddPayments() ? 'w-2/6' : 'w-2/6'">
          <div class="bg-gray-50 border-gray-200 p-4 sticky top-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
              {{ invoice?.invoiceType === InvoiceType.QUOTATION ? 'Quotation' : 'Invoice' }} Summary
            </h3>
            
            <div class="space-y-3">
              <!-- Sub Total -->
              <div class="flex justify-between items-center">
                <label class="text-sm text-gray-600">Sub Total</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.pricing?.subTotal | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-gray-200 text-sm text-right text-gray-700">
              </div>

              <!-- Tax -->
              <div class="flex justify-between items-center">
                <label class="text-sm text-gray-600">Tax ({{invoice?.pricing?.taxRate || 0}}%)</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.pricing?.taxAmount | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-gray-200 text-sm text-right text-gray-700">
              </div>

              <!-- VAT -->
              <div class="flex justify-between items-center">
                <label class="text-sm text-gray-600">VAT ({{invoice?.pricing?.vatRate || 0}}%)</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.pricing?.vatAmount | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-gray-200 text-sm text-right text-gray-700">
              </div>

              <!-- Discount -->
              <div class="flex justify-between items-center">
                <label class="text-sm text-gray-600">Discount</label>
                <input type="number" 
                       min="0"
                       step="50"
                       placeholder="0.00"
                       formControlName="totalDiscount"
                       class="w-32 px-2 py-1 border border-gray-300 text-sm text-right focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>

              <!-- Delivery Charge -->
              <div class="flex justify-between items-center">
                <label class="text-sm text-gray-600">Delivery</label>
                <input type="number" 
                       min="0"
                       step="50"
                       placeholder="0.00"
                       formControlName="deliveryCharge"
                       class="w-32 px-2 py-1 border border-gray-300 text-sm text-right focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>

              <hr class="border-gray-300">

              <!-- Total Amount -->
              <div class="flex justify-between items-center p-2">
                <label class="text-base font-semibold text-gray-800">Total Amount</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.totalAmount | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-blue-200 text-base font-bold text-right text-blue-900">
              </div>

              <!-- Total Paid (Only for Bills) -->
              <div class="flex justify-between items-center p-2" *ngIf="canAddPayments()">
                <label class="text-sm font-medium text-gray-700">Total Paid</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.totalPaid | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-green-200 text-sm text-right font-medium text-green-700">
              </div>

              <!-- Total Due (Only for Bills) -->
              <div class="flex justify-between items-center p-2" *ngIf="canAddPayments()">
                <label class="text-sm font-medium text-gray-700">Amount Due</label>
                <input type="text" 
                       readonly 
                       [value]="'' + (invoice?.remainingAmount | number:'1.2-2')"
                       class="w-32 px-2 py-1 bg-white border border-red-200 text-sm text-right font-medium text-red-700">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Invoice Total in Words -->
      <div class="pt-4">
        <h3 class="text-gray-700">
          <strong>In words: </strong>
          <span class="text-gray-600">{{this.toWords.convert(this.invoice?.totalAmount ?? 0)}}</span>
        </h3>
      </div>

      <!-- Notes Section -->
      <div class="flex flex-col pt-4">
        <label class="text-lg font-semibold text-gray-800 mb-2">Notes</label>
        <p class="text-sm text-gray-600 bg-gray-50 p-3 border">
          <span *ngIf="invoice?.invoiceType === InvoiceType.QUOTATION">
            This quotation is valid for 30 days from the date of issue. Please contact us for any clarifications.
          </span>
          <span *ngIf="invoice?.invoiceType === InvoiceType.BILL">
            Thank you for your business! If you have any questions about this invoice, please contact us.
          </span>
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-row justify-end pt-6 gap-3">
        <button type="submit" 
                class="flex items-center px-4 py-2 rounded-lg transition-colors" 
                [disabled]="invForm.invalid" 
                [ngClass]="{
                  'bg-blue-600 text-white hover:bg-blue-700': !invForm.invalid,
                  'bg-gray-400 text-gray-200 cursor-not-allowed': invForm.invalid
                }">
          <svg-icon src="./assets/icons/heroicons/outline/folder.svg" [svgClass]="'h-5 w-5'"></svg-icon>
          <span class="ml-2">Save</span>
        </button>

        <button type="button" *ngIf="canConvertToBill()"
                class="flex items-center px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition-colors"
                (click)="convertToBill()">
          <svg-icon src="./assets/icons/heroicons/outline/arrow-path.svg" [svgClass]="'h-5 w-5'"></svg-icon>
          <span class="ml-2">Convert to Bill</span>
        </button>

        <button type="button"
                class="flex items-center px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors"
                (click)="previewInvoice()">
          <svg-icon src="./assets/icons/heroicons/outline/eye.svg" [svgClass]="'h-5 w-5'"></svg-icon>
          <span class="ml-2">Preview</span>
        </button>

        <button type="button"
                class="flex items-center px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-colors"
                (click)="downloadInvoice()">
          <svg-icon src="./assets/icons/heroicons/outline/download.svg" [svgClass]="'h-5 w-5'"></svg-icon>
          <span class="ml-2">Download</span>
        </button>

        <button type="button"
                class="flex items-center px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors"
                (click)="backToInvoiceList()">
          <svg-icon src="./assets/icons/heroicons/outline/uturn-back.svg" [svgClass]="'h-5 w-5'"></svg-icon>
          <span class="ml-2">Back</span>
        </button>
      </div>
    </div>
  </form>
</div>